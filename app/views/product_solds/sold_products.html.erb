<h2>Top Product Sold</h2>

<%= button_to 'Today',sold_products_path({start:Date.today, end:Date.today+1}), method: :get %>
<%= link_to 'All Products Sold',sold_products_path({start:@begin, end:@last}), method: :get%>
</br></br>

<%= form_with url: "/product_solds/sold_products",method: :get do |f| %>
  <%= f.label "start" %>
  <%= f.date_field :start, value: @start_date%>
  <span> -- </span>
  <%= f.label "end" %>
  <%= f.date_field :end, value: @end_date%>
  <%= f.submit 'Sort' %>
<% end %>

<table class="table">
  <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col"><%= sort_link(@q, :product_name, 'Product Name', default_order: :asc) %></th>
      <th scope="col"><%= sort_link(@q, :price, 'Price', default_order: :asc) %></th>
      <th scope="col"><%= sort_link(@q, :quantity, 'Quantity', default_order: :asc) %></th>
      <th scope="col"><%= sort_link(@q, :tax, 'Tax(12%)', default_order: :asc) %></th>
      <th scope="col"><%= sort_link(@q, :total_price, 'Total Price', default_order: :asc) %></th>
    </tr>
  </thead>
  <% if @With_data %>
    <tbody>
    <% @Sold_products.each_with_index do |product,idx| %>
      <tr>
        <td><%= idx + 1%> </td>
        <td><%= product[:product_name]%></td>
        <td>&#8369;<%= sprintf('%.2f',product[:price]) %></td>
        <td><%= product[:quantity] %></td>
        <td>&#8369;<%= sprintf('%.2f',product[:tax])%></td>
        <td>&#8369;<%= sprintf('%.2f',product[:total_price])%></td>
      </tr>
    <%end%>
      <tr>
        <td></td>
        <td></td>
        <td><%= link_to 'Print Summary', print_summary_path({start:@start_date, end:@end_date}) %></td> 
        <td><b>Total Quantity: <%= @Total_quantity %></b></td> 
        <td><b>Total Tax: &#8369;<%= sprintf('%.2f',@Tax) %></b></td> 
        <td><b>Total Price: &#8369;<%= sprintf('%.2f',@Total_Price) %></b></td> 
      </tr>    
    </tbody>

  <% else %>
    <tbody>
      <tr>
        <td></td>
        <td></td>
        <td></td>
        <td><h1>No Data</h1></td>
        <td></td>
        <td></td>
      </tr>
    </tbody>
  <% end %>
</table>
</br>

<%= column_chart @Map_products.map { |sale|
   {name: sale[:product], data: sale[:orders], colors: ["#b00", "#666"]}
 }%>
