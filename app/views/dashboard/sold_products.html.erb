<h2>Top Product Sold</h2>

<%= button_to 'Today',sold_products_path({start:Date.today, end:Date.today+1}), method: :get %>


<%= form_with url: "/dashboard/sold_products",method: :get do |f| %>
  <%= f.label "start" %>
  <%= f.date_field :start, value: @start_date%>
  <span> -- </span>
  <%= f.label "end" %>
  <%= f.date_field :end, value: @end_date%>
  <%= f.submit 'Sort' %>
<% end %>

<%= link_to 'All Products',sold_products_path({start:@begin, end:@last}), method: :get%>

<%= @array_total_quantity%>

<table class="table">
  <thead>
    <tr>
      <th scope="col">#</th>
      <th scope="col">Product Name
        <%= form_with url: "/dashboard/sold_products",method: :get do |f| %>
          <%= f.hidden_field :start, value:@start_date %>
          <%= f.hidden_field :end, value:@end_date %>
          <select name="sort" id="sort">
            <option value= "">select</option>
            <option value= "product_asc">ascending</option>
            <option value="product_desc">descending</option>
          </select>
          <%= f.submit "sort" %>
        <% end %>
      </th>
      <th scope="col">Price
        <%= form_with url: "/dashboard/sold_products",method: :get do |f| %>
          <%= f.hidden_field :start, value:@start_date %>
          <%= f.hidden_field :end, value:@end_date %>
          <select name="sort" id="sort">
            <option value= "">select</option>
            <option value= "price_asc">ascending</option>
            <option value="price_desc">descending</option>
          </select>
          <%= f.submit "sort" %>
        <% end %>
      </th>
      <th scope="col">Quantity
        <%= form_with url: "/dashboard/sold_products",method: :get do |f| %>
          <%= f.hidden_field :start, value:@start_date %>
          <%= f.hidden_field :end, value:@end_date %>
          <select name="sort" id="sort">
            <option value= "">select</option>
            <option value= "quantity_asc">ascending</option>
            <option value="quantity_desc">descending</option>
          </select>
          <%= f.submit "sort" %>
        <% end %>
      </th>
      <th scope="col">Tax(12%)</th>      
      <th scope="col">Total Price
        <%= form_with url: "/dashboard/sold_products",method: :get do |f| %>
          <%= f.hidden_field :start, value:@start_date %>
          <%= f.hidden_field :end, value:@end_date %>
          <select name="sort" id="sort">
            <option value= "">select</option>
            <option value= "total_price_asc">ascending</option>
            <option value="total_price_desc">descending</option>
          </select>
          <%= f.submit "sort" %>
        <% end %>      
      </th>
    </tr>
  </thead>
  <tbody>
  <% @Product_Report.each_with_index do |product,idx|%>
        <tr>
          <td><%= idx + 1%> </td>
          <td><%= product[:product_name]%> </td>
          <td>
          <% if product[:price_array].count == 1%>
            &#8369;<%=sprintf('%.2f',product[:price_array][0].keys[0])%>
          <% else %>
            <% product[:price_array].each do |price| %>
                <% if product[:price] == price.keys[0] %>
                  <b>(&#8369;<%=sprintf('%.2f',price.keys[0])%> x 
                  <%=price.values[0]%>)</b>  
                <% else %> 
                  <i>(&#8369;<%=sprintf('%.2f',price.keys[0])%> x 
                  <%=price.values[0]%>)</i>                                 
                <% end %> 

            <% end %>          
          <% end %>
          </td>
          <td><%= product[:quantity] == nil ? 0 : product[:quantity]%></td>
          <td>&#8369;<%= sprintf('%.2f',product[:quantity] == nil ? 0 : product[:quantity] * product[:price] * 0.12)%></td>
          <td>&#8369;<%= sprintf('%.2f',product[:sold_price] == nil ? 0 : product[:sold_price])%></td>
        </tr>
    <%end%>
        <tr>
          <td></td>
          <td></td>
          <td><%= link_to 'Print Summary', print_summary_path({start:@start_date, end:@end_date})%></td>
          <td><b>Total Quantity: <p><%= @Total_Quantity%></p></b></td>
          <td><b>Total Tax: <p>&#8369;<%= sprintf('%.2f',(@Total_Price/1.12)*0.12)%></p></b></td>
          <td><b>Total Price: <p>&#8369;<%= sprintf('%.2f',@Total_Price)%></p></b></td>
        </tr>    
  </tbody>
</table>
</br>
<%= column_chart @Map_products.map { |sale|
   {name: sale[:product], data: sale[:orders], colors: ["#b00", "#666"]}
 }%>
